

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>gpp_common &mdash; MOE 0.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/breathe.css" type="text/css" />
  
    <link rel="top" title="MOE 0.1.0 documentation" href="index.html"/>
        <link rel="up" title="C++ Files" href="cpp_tree.html"/>
        <link rel="prev" title="gpp_python_gaussian_process" href="gpp_python_gaussian_process.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> MOE</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="why_moe.html">Why Do We Need MOE?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="why_moe.html#other-methods">Other Methods</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#install-in-docker">Install in docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#install-from-source">Install from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#osx-tips">OSX Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#building-boost">Building Boost</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#linux-tips">Linux Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#cmake-tips">CMake Tips</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="moe_math.html">How does MOE work?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="moe_math.html#build-a-gaussian-process-gp-with-the-historical-data">Build a Gaussian Process (GP) with the historical data</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_math.html#optimize-the-hyperparameters-of-the-gaussian-process">Optimize the hyperparameters of the Gaussian Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_math.html#find-the-point-s-of-highest-expected-improvement-ei">Find the point(s) of highest Expected Improvement (EI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_math.html#return-the-point-s-to-sample-then-repeat">Return the point(s) to sample, then repeat</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="demo_tutorial.html">Demo Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="demo_tutorial.html#the-interactive-demo">The Interactive Demo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pretty_endpoints.html">Pretty Endpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="objective_functions.html">Objective Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="objective_functions.html#what-is-an-objective-function">What is an objective function?</a></li>
<li class="toctree-l2"><a class="reference internal" href="objective_functions.html#properties-of-an-objective-function">Properties of an objective function</a></li>
<li class="toctree-l2"><a class="reference internal" href="objective_functions.html#parameters">Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="objective_functions.html#id1"><span class="math">\(\Phi\)</span> Objective Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="objective_functions.html#example-of-objective-functions">Example of Objective Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples.html#minimizing-an-arbitrary-function">Minimizing an arbitrary function</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#gaussian-process-regression-given-historical-data">Gaussian Process regression given historical data</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#hyperparameter-optimization-of-a-gaussian-process">Hyperparameter optimization of a Gaussian Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#all-above-examples-combined">All above examples combined</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#setting-thresholds-for-advertising-units">Setting thresholds for advertising units</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#making-a-pull-request">Making a pull request</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#style">Style</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="moe.html">moe package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="moe.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe.html#module-moe.resources">moe.resources module</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe.html#module-moe">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="moe_examples.html">moe_examples package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#module-moe_examples.combined_example">moe_examples.combined_example module</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#module-moe_examples.hyper_opt_of_gp_from_historical_data">moe_examples.hyper_opt_of_gp_from_historical_data module</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#module-moe_examples.mean_and_var_of_gp_from_historic_data">moe_examples.mean_and_var_of_gp_from_historic_data module</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#module-moe_examples.next_point_via_simple_endpoint">moe_examples.next_point_via_simple_endpoint module</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#module-moe_examples">Module contents</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="cpp_tree.html">C++ Files</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gpp_optimization_test.html">gpp_optimization_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_domain_test.html">gpp_domain_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_exception.html">gpp_exception</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_geometry.html">gpp_geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_heuristic_expected_improvement_optimization.html">gpp_heuristic_expected_improvement_optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_linear_algebra-inl.html">gpp_linear_algebra-inl</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_test_utils.html">gpp_test_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_logging.html">gpp_logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_covariance.html">gpp_covariance</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_python_test.html">gpp_python_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_domain.html">gpp_domain</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_python_common.html">gpp_python_common</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_hyperparameter_optimization_demo.html">gpp_hyperparameter_optimization_demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_test_utils_test.html">gpp_test_utils_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_math_test.html">gpp_math_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_python_expected_improvement.html">gpp_python_expected_improvement</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_python_model_selection.html">gpp_python_model_selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_math.html">gpp_math</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_random_test.html">gpp_random_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_optimizer_parameters.html">gpp_optimizer_parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_expected_improvement_demo.html">gpp_expected_improvement_demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_random.html">gpp_random</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_geometry_test.html">gpp_geometry_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_linear_algebra.html">gpp_linear_algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_heuristic_expected_improvement_optimization_test.html">gpp_heuristic_expected_improvement_optimization_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_linear_algebra_test.html">gpp_linear_algebra_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_model_selection.html">gpp_model_selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_optimization.html">gpp_optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_covariance_test.html">gpp_covariance_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_mock_optimization_objective_functions.html">gpp_mock_optimization_objective_functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_python.html">gpp_python</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_model_selection_test.html">gpp_model_selection_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_hyper_and_EI_demo.html">gpp_hyper_and_EI_demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_python_gaussian_process.html">gpp_python_gaussian_process</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">gpp_common</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">MOE</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="cpp_tree.html">C++ Files</a> &raquo;</li>
      
    <li>gpp_common</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/gpp_common.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="gpp-common">
<h1>gpp_common<a class="headerlink" href="#gpp-common" title="Permalink to this headline">¶</a></h1>
<p><strong>Contents:</strong></p>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference internal" href="#gpp-common-hpp">gpp_common.hpp</a></li>
</ol>
</div></blockquote>
<div class="section" id="gpp-common-hpp">
<h2>gpp_common.hpp<a class="headerlink" href="#gpp-common-hpp" title="Permalink to this headline">¶</a></h2>
<p></p>
<p><p>This file contains some additional style specifications and notes on implementation details in the header
comments.</p>
<p>This file also contains a few compiler macros that are used in most files throughout this project.
This includes macros for disallowing constructors, common constants, gcc compiler hints, etc.  The usage
and meaning of these are detailed in comments above their definitions.</p>
<p>I am aware that the Google Style Guide eschews compiler macros but I don&#8217;t see a better way to do most
of this.</p>
<p><strong>IMPLEMENTATION NOTES</strong></p>
<ol class="arabic">
<li><p class="first">No function in this project allocates memory that the caller must free.
In particular, this means that array outputs must be allocated by the caller.
Additionally, class members should never be plain pointers&#8211;use std::unique_ptr to guarantee that
memory is released appropriately.</p>
<dl class="docutils">
<dt>In fact, <tt class="docutils literal"><span class="pre">new</span></tt> and <tt class="docutils literal"><span class="pre">delete</span></tt> (as they pertain to memory) should almost NEVER be used.</dt>
<dd><p class="first last">Exception: <tt class="docutils literal"><span class="pre">Clone()</span></tt> functions and inputs to std::unique_ptr&#8217;s ctor may use <tt class="docutils literal"><span class="pre">new</span></tt>.</p>
</dd>
</dl>
<p>Finally, <tt class="docutils literal"><span class="pre">malloc</span></tt>/<tt class="docutils literal"><span class="pre">free</span></tt> should be AVOIDED ENTIRELY.  Use std::vector instead of malloc&#8217;d arrays and
std::unique_ptr when singleton object allocation is desired.  If you <em>ABSOLUTELY</em> must, use <tt class="docutils literal"><span class="pre">new</span></tt>/<tt class="docutils literal"><span class="pre">delete</span></tt>
and <tt class="docutils literal"><span class="pre">new[]</span></tt>/<tt class="docutils literal"><span class="pre">delete[]</span></tt>, NOT <tt class="docutils literal"><span class="pre">malloc</span></tt>/<tt class="docutils literal"><span class="pre">free</span></tt>.</p>
</li>
<li><p class="first">Matrices are stored as flattened arrays and indexed in COLUMN-MAJOR order.
2D (and more generally nD) matrices are strictly NOT ALLOWED.</p>
<p>However, for convenience, C multi-dimensional indexing will be used to describe
matrices: e.g., A[dim1][dim2] is a matrix with dim1 rows and dim2 columns.  But
dim1 is the most rapidly-varying index here.
for example: <tt class="docutils literal"><span class="pre">A[3][4]</span> <span class="pre">=</span></tt>
<tt class="docutils literal"><span class="pre">[4</span>&nbsp; <span class="pre">32</span>&nbsp; <span class="pre">5</span>&nbsp; <span class="pre">2</span></tt>
`` 53 12  8  1``
`` 81  2  93 0]``</p>
<blockquote>
<div><p>would be FLATTENED into an array:
<tt class="docutils literal"><span class="pre">A_flat[12]</span> <span class="pre">=</span> <span class="pre">[4</span> <span class="pre">53</span> <span class="pre">81</span> <span class="pre">32</span> <span class="pre">12</span> <span class="pre">2</span> <span class="pre">5</span> <span class="pre">8</span> <span class="pre">93</span> <span class="pre">2</span> <span class="pre">1</span> <span class="pre">0]</span></tt></p>
<p>So <tt class="docutils literal"><span class="pre">A[dim_1][dim_2]...[dim_n]</span></tt> would be represented as an array of size
<tt class="docutils literal"><span class="pre">dim_1*dim_2*...*dim_n</span></tt>.
If I wanted to access <tt class="docutils literal"><span class="pre">A[i_1][i_2]...[i_n]</span></tt> in a multi-dimensional array, I would perform the following
in a flat array:
<tt class="docutils literal"><span class="pre">A[i_n*dim_1*dim_2*...*dim_{n-1}</span> <span class="pre">+</span> <span class="pre">...</span> <span class="pre">+</span> <span class="pre">i_2*dim_1</span> <span class="pre">+</span> <span class="pre">i_1]</span></tt> (note that <tt class="docutils literal"><span class="pre">dim_n</span></tt> never appears in the index!)
(See gpp_math.cpp header comments for more details on a more efficient way of array accessing.)</p>
</div></blockquote>
</li>
</ol>
<blockquote>
<div><ol class="arabic" start="3">
<li><p class="first">The meaning of <tt class="docutils literal"><span class="pre">lda,</span> <span class="pre">ldb,</span> <span class="pre">ldc</span></tt>.  <tt class="docutils literal"><span class="pre">lda</span></tt>, for example, is short for
&#8220;leading dimension [of the matrix] A&#8221;.  This is notion is equivalent to that of column-stride,
the number of elements between adjacent elements of a row.  (Note we always use unit row-stride
for matrix storage; i.e., adjacent elements in a column are stored next to each other in memory.)
These parameters are useful for indicating that a matrix is allocated larger than the specified size.
For example, if we wanted to compute a matrix product using only the leading 5x5 submatrix of A and
A is allocated as <tt class="docutils literal"><span class="pre">A[25][25]</span></tt>, we could call multply with the size set to 5 and
lda set to 25.  This avoids needless copying while maintaining reasonable locality, since
the row-stride remains 1 and the column-stride is 25.  Compare to an array allocated as <tt class="docutils literal"><span class="pre">B[5][5]</span></tt>,
which has row-stride 1 and column-stride 5.</p>
<p>Additionally, note that this technique is more general than just obtaining leading principal submatrices; we
can obtain any submatrix.  For example, to get <tt class="docutils literal"><span class="pre">A[2:6][8:15]</span></tt> from <tt class="docutils literal"><span class="pre">A[25][25]</span></tt>, we would pass in <tt class="docutils literal"><span class="pre">A'</span> <span class="pre">=</span> <span class="pre">A</span> <span class="pre">+</span> <span class="pre">8*25</span> <span class="pre">+</span> <span class="pre">2</span></tt>, which
points to the first element of the desired submatrix.  Then we set <tt class="docutils literal"><span class="pre">n_rows</span> <span class="pre">=</span> <span class="pre">5,</span> <span class="pre">n_columns</span> <span class="pre">=</span> <span class="pre">8,</span> <span class="pre">lda</span> <span class="pre">=</span> <span class="pre">25</span></tt>.</p>
</li>
<li><p class="first">Keywords:
In general, see details in the body of this file (e.g., if you don&#8217;t know what &#8220;likely&#8221; is, search for
&#8220;#define likely&#8221;) for the various specifiers and keywords we use heavily.  gcc documentation, stackoverflow,
cppreference, and wikipedia can be additional good sources of info.</p>
<ol class="loweralpha simple">
<li>mark all pointers <tt class="docutils literal"><span class="pre">const</span></tt> whenever appropriate (e.g., all inputs)</li>
<li>mark all class member functions <tt class="docutils literal"><span class="pre">const</span></tt> whenever appropriate (this should be nearly all member functions!)</li>
<li>mark all pointers <tt class="docutils literal"><span class="pre">restrict</span></tt> whenever appropriate (see details in the definition of restrict below for more info)
in fact, essentially ALL pointers should be marked <tt class="docutils literal"><span class="pre">restrict</span></tt></li>
<li>we use some gcc compiler hints: <tt class="docutils literal"><span class="pre">__builtin_expect</span></tt> to express <tt class="docutils literal"><span class="pre">likely</span></tt> and <tt class="docutils literal"><span class="pre">unlikely</span></tt> as hints about when
loop branches are very common or uncommon (do not be overzealous with this!)</li>
<li>we also use several gcc attributes:<ul>
<li><tt class="docutils literal"><span class="pre">unused</span></tt>: suppresses compiler warnings when we expect variables/functions to be unsused</li>
<li><tt class="docutils literal"><span class="pre">nonnull_pointers</span></tt>: compiler warnings when pointer args are <tt class="docutils literal"><span class="pre">nullptr</span></tt> (see details for special case with class member fcns)</li>
<li><tt class="docutils literal"><span class="pre">warn_unused_result</span></tt>: compiler warning when return value is unused</li>
<li><tt class="docutils literal"><span class="pre">__pure__,</span> <span class="pre">__const__</span></tt>: describes a function&#8217;s dependencies/effects on global state</li>
<li><tt class="docutils literal"><span class="pre">final</span></tt>: no subclass can derive from this (class level) or no function can override this (fcn level)</li>
<li><tt class="docutils literal"><span class="pre">override</span></tt>: this function MUST override a base class method</li>
<li><tt class="docutils literal"><span class="pre">noexcept</span></tt>: this function CANNOT throw exceptions</li>
</ul>
</li>
</ol>
</li>
<li><p class="first">When designing objects, separate them from their [mutable] state.  This is to make it possible to explicitly see
which components should be constant during execution and which components are stateful or temporary.  This separation
(or something like it) is also necessary for avoiding repeated work/allocation during multithreading by clearly
labeling what data must be thread-local.</p>
<p>The following discussion draws its examples from the objects in gpp_math.hpp/cpp.
For example, if the &#8220;core&#8221; object is LogMarginalLikelihoodEvaluator, then its state might be LogMarginalLikelihoodState.
For convenience, the &#8220;core&#8221; object should register its State type in a type alias for &#8220;StateType&#8221;; e.g.,
``  using StateType = FooState;``</p>
<p>And the state object should register an &#8220;EvaluatorType&#8221; (or whatever name is convenient); e.g.,
``  using EvaluatorType = FooEvaluator;``</p>
<p>State objects will be structs, possibly with simple routines to help with memory management/setup.  They should have
no complex logic, as manipulating their data should only be done by the &#8220;core&#8221; object.</p>
<p>Foo&#8217;s state should never be manipulated directly.  Instead, Foo should initialize its State, and then its State
should be passed as a parameter to its member functions.  This relationship is explained in detail in the docs for
GaussianProcess and its state, PointsToSampleState.  In general, the setup will look like:</p>
<div class="highlight-python"><div class="highlight"><pre>struct FooState;  // forward declaration needed for enums, pointers, references in Foo
class Foo {
 public:
  using StateType = FooState;

  FillState(StateType *) const {  &lt;-- usually not called directly, use FooState.SetupState instead
    ...direct manipulation of FooState members...
  }

  ComputeSomethingThatUsesState(const StateType&amp;) const {
    ...
  }

  ComputeSomethingThatModifiesState(StateType *) const {
    ...
  }
}

struct FooState {
  FooState(const Foo&amp; foo) {
    SetupState(foo);
  }

  SetupState(const Foo&amp; foo) { &lt;-- safest way to setup state; ensures data sizes are correct
    ...code to ensure data size is correct...
    foo.FillState(this);  &lt;-- call foo to configure self
  }

  ...public data members...
}
</pre></div>
</div>
<p>Then these would be used:</p>
<div class="highlight-python"><div class="highlight"><pre>ComputeSomethingWithFoo(const Foo&amp; foo) {
  Foo::StateType foo_state(foo);
  foo.ComputeSomething(foo_state);
}
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-python"><div class="highlight"><pre>ComputeSomethingWithFoo(const Foo&amp; foo, Foo::StateType * foo_state) {
  foo_state.SetupState(foo);  &lt;-- optional depending on preconditions
  foo.ComputeSomething(foo_state);
}
</pre></div>
</div>
<p>Finally, the data members of a State are usually broken into two parts:</p>
<ol class="loweralpha simple">
<li>Problem specification:
e.g., size data, hyperparameters, points being sampled or other quantities
that would be updated over the course of say gradient descent</li>
<li>Derived quantities:
These are members that are a function of the problem specification that are also
worth precomputing.  This is what
<tt class="docutils literal"><span class="pre">foo_state.SetupState(foo);</span></tt>
would initialize, where applicable.</li>
<li>Temporary storage:
These members are more like pre-allocated space for work in State&#8217;s consumers; e.g., for
storing intermediate results.  Temporary storage can be overwitten with anything and have unreliable state.
The State&#8217;s constructor must size them properly, but their contents can be <em>anything</em>.
DO NOT rely on the values in these members!  Set before using!</li>
</ol>
<p>List of classes implementing this relationship:
<tt class="docutils literal"><span class="pre">Class</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="pre">State</span></tt>
<tt class="docutils literal"><span class="pre">GaussianProcess</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="pre">PointsToSampleState</span></tt>
<tt class="docutils literal"><span class="pre">ExpectedImprovementEvaluator</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="pre">ExpectedImprovementState</span></tt>
<tt class="docutils literal"><span class="pre">OnePotentialSampleExpectedImprovementEvaluator</span>&nbsp; <span class="pre">OnePotentialSampleExpectedImprovementState</span></tt>
<tt class="docutils literal"><span class="pre">LogMarginalLikelihoodEvaluator</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="pre">LogMarginalLikelihoodState</span></tt>
<tt class="docutils literal"><span class="pre">LeaveOneOutLogLikelihoodEvaluator</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="pre">LeaveOneOutLogLikelihoodState</span></tt></p>
<p>One set of noteable exceptions to this &#8216;rule&#8217; is the RNG classes.  These objects&#8217; sole purpose
is to hold mutable state so there&#8217;s nothing to be gained from just splitting code and data members.</p>
</li>
<li><p class="first">Explicit [template] Instantiation.
Summarizing the syntax briefly:</p>
<p><strong>FOR FUNCTIONS</strong></p>
<p>IN THE HPP FILE:</p>
<div class="highlight-python"><div class="highlight"><pre>template &lt;typename type1, typename type2, ...&gt;
void SomeFunction(int arg1, type1 arg2, ...);  // template function declaration

extern template void SomeFunction(int, SPECIFIC_TYPE arg2, ...);  // explicit instantiation DECLARATION
// you must specify all template parameters (type1, type2, ...) and replace them in the fcn&#39;s argument list
</pre></div>
</div>
<p>END HPP FILE</p>
<p>IN THE CPP FILE:</p>
<div class="highlight-python"><div class="highlight"><pre>template &lt;typename type1, typename type2, ...&gt;
void SomeFunction(int arg1, type1 arg2, ...) {  // template function definition
  ...your code here...
}

template void SomeFunction(int, SPECIFIC_TYPE arg2, ...);  // explicit instantiation DEFINITION
// this is identical to explicit instantiation line in the HPP file, except no &quot;extern&quot; keyword
</pre></div>
</div>
<p>END CPP FILE</p>
<p><strong>FOR CLASSES</strong></p>
<p>IN THE HPP FILE:</p>
<div class="highlight-python"><div class="highlight"><pre>template &lt;typename type1, typename type2, ...&gt;
class SomeClass {  // template class declaration
  ...
};

extern template class SomeClass&lt;SPECIFIC_TYPE&gt;;  // extern declaration telling compiler NOT to instantiate the
                                                 // current translation unit
</pre></div>
</div>
<p>END HPP FILE</p>
<p>IN THE CPP FILE:</p>
<div class="highlight-python"><div class="highlight"><pre>SomeClass::SomeMethod(...) {  // any implementations you are hiding
  ...
}

template class SomeClass&lt;SPECIFIC_TYPE&gt;;  // obliges compiler to instantiate a template
</pre></div>
</div>
<p>END CPP FILE</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this is NOT the same as template SPECIALIZATION.</p>
</div>
<p><strong>What happens when the compiler sees a templated call?</strong></p>
<p>When the C++ compiler encounters a templated call, it will instantiate the template with the appropriate types and compile
that code.  This is done once per type combination, per compilation unit.  To do this, the definition of the template
must be visible.  At link-time, the (potentially) duplicate copies are coalesced.</p>
<p><strong>What is explicit instantiation?</strong></p>
<p>The explicit instantiation definition tells the compiler to emit code for that particular combination of template
parameters in the present compilation unit.</p>
<p>The explicit instantiation declaration tells the compiler that a symbol for the instantiated call (with that specific
combination of template parameters) exists somewhere.  (This is identical to the usage of &#8220;extern&#8221; in C.)  It will leave
an &#8220;endpoint&#8221; that the linker will connect later.</p>
<p><strong>Why use explicit instantiation?</strong></p>
<ol class="loweralpha">
<li><p class="first">Only way to expose templated functionality in libraries (e.g., .dll/.so/.a) WITHOUT exposing the implementation.</p>
<p>So if you do not want to expose the template definition in a header, explicit instantiation is the only way to
provide functionality from templates in libraries.</p>
</li>
<li><p class="first">Speeds up compilation.</p>
<p>If you have the same type combinations in many compilation units, this can slow compile time substantially, especially
for complex templates.</p>
</li>
<li><p class="first">Restricts how your template can be used (e.g., if you are using templates more like glorified C macros).</p>
<p>No instantiations (in compilation units outside the unit containing the definition) are possible except the
explicit ones.</p>
</li>
</ol>
<p>In this project, B and C are our main reasons for template instantiation.  It keeps compile-times down and we are mostly
using templates to save copy-pasting code (let the compiler do it for you through templates!).  Think of it as static
polymorphism.  Generally we explicitly instantiate large/complex templates and leave simple definitions in the header
(also keeps headers clean).</p>
<p>For those unfamiliar with the concept, further reading:
<a class="reference external" href="http://pic.dhe.ibm.com/infocenter/lnxpcomp/v111v131/index.jsp?topic=%2Fcom.ibm.xlcpp111.linux.doc%2Flanguage_ref%2Fexplicit_instantiation.html">http://pic.dhe.ibm.com/infocenter/lnxpcomp/v111v131/index.jsp?topic=%2Fcom.ibm.xlcpp111.linux.doc%2Flanguage_ref%2Fexplicit_instantiation.html</a>
<a class="reference external" href="http://msdn.microsoft.com/en-us/library/7k8twfx7.aspx">http://msdn.microsoft.com/en-us/library/7k8twfx7.aspx</a>
<a class="reference external" href="http://stackoverflow.com/questions/2351148/explicit-instantiation-when-is-it-used">http://stackoverflow.com/questions/2351148/explicit-instantiation-when-is-it-used</a></p>
</li>
<li><p class="first">Matrix-loop Idiom
The matrix looping idioms used in this file deserve some explanation; we&#8217;ll use matrix-vector-multiply
as an example.  One common implementation of <tt class="docutils literal"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">A</span> <span class="pre">*</span> <span class="pre">x</span></tt>, with a <tt class="docutils literal"><span class="pre">m</span> <span class="pre">x</span> <span class="pre">n</span></tt>, row-major matrix is:</p>
<div class="highlight-python"><div class="highlight"><pre>double const * restrict A = ...;
double const * restrict x = ...;
double * restrict y = ...;
for (int i = 0; i &lt; m; ++i) {
  y[i] = 0;
  for (int j = 0; j &lt; n; ++j) {
    y[i] += A[i*n + j]*x[j]
  }
}
</pre></div>
</div>
<p>Instead, we use:</p>
<div class="highlight-python"><div class="highlight"><pre>for (int i = 0; i &lt; m; ++i) {
  y[i] = 0;
  for (int j = 0; j &lt; n; ++j) {
    y[i] += A[j]*x[j];
  }
  A += n;
}
</pre></div>
</div>
<p>Pros:</p>
<ol class="loweralpha simple">
<li>Avoids extra integer arithmetic: redundant <tt class="docutils literal"><span class="pre">i*n</span></tt> computations removed. (Compiler may save off <tt class="docutils literal"><span class="pre">i*n</span></tt>)
Also greatly reduces number of characters: indexing <tt class="docutils literal"><span class="pre">A[i*dim_1*dim_2</span> <span class="pre">+</span> <span class="pre">j*dim_2</span> <span class="pre">+</span> <span class="pre">k]</span></tt> for example is unwieldy.</li>
<li>Simple offsets like <tt class="docutils literal"><span class="pre">A[j]</span></tt> can be computed with just one x86 instruction, <tt class="docutils literal"><span class="pre">LEA</span></tt>.  (<tt class="docutils literal"><span class="pre">A[i*n</span> <span class="pre">+</span> <span class="pre">j]</span></tt> requires 2-3)
<tt class="docutils literal"><span class="pre">LEA</span></tt> cannot handle <tt class="docutils literal"><span class="pre">A[g</span> <span class="pre">+</span> <span class="pre">j]</span></tt>, so compilers (currently) will not optimize this for you.</li>
<li>This style makes it more clear that the inner loop is just a dot-product.  This may also improve the compiler&#8217;s
ability to vectorize.</li>
</ol>
<p>Cons:</p>
<ol class="loweralpha simple">
<li>Overwrites the pointer <tt class="docutils literal"><span class="pre">A</span></tt>.  If the full <tt class="docutils literal"><span class="pre">A</span></tt> matrix is required again, we need to store it before this loop
or set <tt class="docutils literal"><span class="pre">A</span> <span class="pre">-=</span> <span class="pre">m*n</span></tt>; after the loop.  (Compiler optimization makes this a non-issue.)</li>
<li>Following a., leaves the pointer <tt class="docutils literal"><span class="pre">A</span></tt> in an invalid state.  After the loop completes, <tt class="docutils literal"><span class="pre">A[0]</span></tt> would generally
dereference unallocated space.</li>
<li>Is not the most common idiom and may feel unfamiliar to some programmers.</li>
</ol>
</li>
<li><p class="first">RAII (Resource Acquisition Is Initialization)
We use RAII, no exceptions.
RAII ensures (amongst other things) that allocation/deallocation are always tightly coupled (through dtors): when
an object goes out of scope, its resources are released. So it is impossible to forget to call delete after new and
no additional code is needed to ensure delete is called if an exception is thrown.</p>
<p>In particular, you will not make &#8220;bare&#8221; calls to new/delete (or malloc/free), fopen/fclose, etc. nor will you
implement &#8216;bare&#8217; locks in ints, etc. Use the proper object or container (even if it&#8217;s just std::unique_ptr or similar).</p>
<p>For more information, see:
<a class="reference external" href="http://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization">http://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization</a>
<a class="reference external" href="http://www.stroustrup.com/except.pdf">http://www.stroustrup.com/except.pdf</a></p>
</li>
<li><p class="first">Exception Safety
All library components provide &#8220;basic&#8221; exception safety. &#8220;Basic&#8221; safety means that all invariants of the component
are preserved and no resources are leaked. See references below for more details/definitions. RAII (see item 9)
makes providing the basic guarantee all but trivial.</p>
<p>Some components provide stronger guarantees (e.g., functions marked noexcept).
Additionally, operations on Evaluator/State pairs (see item 5) can be endowed with &#8220;strong&#8221; exception safety
easily if desired. Simply provide a wrapper class that saves the state and resets if an exception is thrown.
For example:</p>
<div class="highlight-python"><div class="highlight"><pre>struct State {
  void ComputationWithBasicGuarantee(...);
  void UpdateCurrentPoint(double *);
  void GetCurrentPoint(doubl e*);
  int GetProblemSize();
};

struct StateWrapper : public State {
  void ComputationWithStrongGuarantee(...) {
    std::vector&lt;double&gt; point(GetProblemSize());
    GetCurrentPoint(point.data());  // save valid, original state
    try {
      ComputationWithBasicGuarantee(...);
    } catch (const std::exception&amp; e) {
      UpdateCurrentPoint(point.data());  // reset state
      throw;
    }
  }
};
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">if State has a random number generator, then its internal state may need to be saved as well. Generally this</p>
</div>
<p>is NOT necessary! The RNG is guaranteed to be in a valid state, and users should have no reason to care what
the precise state of the RNG is. (Still if you do care, the RNG wrappers in gpp_random.hpp can save state.)</p>
<p>See here for further information on the different types of exception safety:
<a class="reference external" href="http://en.wikipedia.org/wiki/Exception_safety">http://en.wikipedia.org/wiki/Exception_safety</a>
<a class="reference external" href="http://www.boost.org/community/exception_safety.html">http://www.boost.org/community/exception_safety.html</a></p>
</li>
</ol>
</div></blockquote>
<p>Lastly, some general mathematical notation:
A vector &#8220;x&#8221; of length size may be represented: (LOWER CASE letters)
<tt class="docutils literal"><span class="pre">x[size],</span> <span class="pre">x_i</span></tt></p>
<p>A matrix &#8220;A&#8221; of size size_1 x size_2 (#rows x #columns) may be represented: (UPPER CASE letters)
<tt class="docutils literal"><span class="pre">A[size_1][size_2],</span> <span class="pre">A_{i,j},</span> <span class="pre">A_ij</span></tt>
<tt class="docutils literal"><span class="pre">A_i</span></tt> may also be used to refer to the i-th column of a matrix A.
Matrices are stored flat in column-major (implementation note 2).  So the concept <tt class="docutils literal"><span class="pre">A[i][j]</span></tt> is actually accessed via:
<tt class="docutils literal"><span class="pre">A[j*size_1</span> <span class="pre">+</span> <span class="pre">i]</span></tt></p>
<p>Finally, a note about function comment style:</p>
<ol class="loweralpha">
<li><p class="first">comments go above the function declaration or definition they describe</p>
</li>
<li><p class="first">declaration comments should individually describe all inputs/ouputs/returns using RST markdown; e.g.,</p>
<div class="highlight-python"><div class="highlight"><pre>**Parameters**:
  :size: number of variables
  :x[size]: vector of input variables
  :A[size][size]: matrix describing relation of i-th, j-th input variables
**Outputs**:
  :y[size]: vector of computed results
**Returns**:
  returns the confidence score of the results, y
</pre></div>
</div>
<p>double ComputeStuff(int size, double const * restrict x, double const * restrict A, double * restrict y);</p>
<p>Here, <tt class="docutils literal"><span class="pre">A[size][size]</span></tt> indicates the size and data-ordering of <tt class="docutils literal"><span class="pre">A</span></tt>: it has size rows and size columns, and is stored
column-major (see implementation note 2).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">if we have a <tt class="docutils literal"><span class="pre">char*</span></tt> argument, <tt class="docutils literal"><span class="pre">my_str</span></tt>, we will generally not specify the
array size, instead writing:</p>
</div>
<p><tt class="docutils literal"><span class="pre">my_str[]:</span> <span class="pre">a</span> <span class="pre">pointer</span> <span class="pre">to</span> <span class="pre">a</span> <span class="pre">char</span> <span class="pre">array</span></tt>
since std::strlen() can be used to find the length.</p>
</li>
</ol>
 </p>
<em>Defines</em><blockquote>
<div><p><span class="target" id="project0gpp__common_8hpp_1a945363551d7c94d986998c704e59d934"></span><strong>OL_DISALLOW_DEFAULT_CONSTRUCTOR</strong>(TypeName)</p>
<blockquote>
<div><p></p>
<p><p>Macros declare copy and assignment operators for C++ classes.  It is intended to place these
in the private (or possibly protected) segments of a class to disallow these actions.</p>
<p>Unless absolutely necessary, classes should disallow both of these operations.</p>
 </p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1a6bccb7a08dab51bed5b6de076eba8c33"></span><strong>OL_DISALLOW_COPY</strong>(TypeName)</p>
<blockquote>
<div><p></p>
<p></p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1a974f71934e3af43a8a5be6b9bbfa9175"></span><strong>OL_DISALLOW_ASSIGN</strong>(TypeName)</p>
<blockquote>
<div><p></p>
<p></p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1ae19e5de9353375e7e07323916e4e1353"></span><strong>OL_DISALLOW_COPY_AND_ASSIGN</strong>(TypeName)</p>
<blockquote>
<div><p></p>
<p></p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1a9466656f962d2934af071e3126e9f11d"></span><strong>OL_DISALLOW_DEFAULT_AND_COPY_AND_ASSIGN</strong>(TypeName)</p>
<blockquote>
<div><p></p>
<p></p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1ac9b997f13fdf943f8d14ff626b8f5e28"></span><strong>OL_DISALLOW_DEFAULT_AND_ASSIGN</strong>(TypeName)</p>
<blockquote>
<div><p></p>
<p></p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1ac6e6ec705ca6be032cc1b020c921920c"></span><strong>OL_CURRENT_FUNCTION_NAME</strong></p>
<blockquote>
<div><p></p>
<p><p>Macros for printing the name of the function immediately containing the macro.
__PRETTY_FUNCTION__ is preferred when supported; it prints additional information about
template parameters and function arguments.</p>
<p>Note that currently in C++ (gcc 4.x.x), both __func__ and __PRETTY_FUNCTION__ are
variables, NOT macros! The compiler implicitly declares:
static const char __func__[] = &#8220;some_name&#8221;;
<a class="reference external" href="http://stackoverflow.com/questions/4384765/whats-the-difference-between-pretty-function-function-func">http://stackoverflow.com/questions/4384765/whats-the-difference-between-pretty-function-function-func</a></p>
<p>Redefine to empty-string if you do not want this behavior.</p>
 </p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1ad8700448546b3b5111404cc021061fd5"></span><strong>unlikely</strong>(expr)</p>
<blockquote>
<div><p></p>
<p><p>Macros that call compiler hints to aid in branch prediction.  These use <tt class="docutils literal"><span class="pre">__builtin_expect()</span></tt>,
which is a gcc extension to the C language:
<a class="reference external" href="http://gcc.gnu.org/onlinedocs/gcc-4.7.2/gcc/Other-Builtins.html">http://gcc.gnu.org/onlinedocs/gcc-4.7.2/gcc/Other-Builtins.html</a>
It&#8217;s at least supported by gcc and icc.</p>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre>if (likely(condition)) {
  DoTask();
} else {
  HandleError();
}
</pre></div>
</div>
<p>Don&#8217;t be overzealous with this hint: it&#8217;s the most applicable for:</p>
<ol class="arabic simple">
<li>branches that almost never happen (e.g., errors)</li>
<li>branches that need to run as fast as possible</li>
</ol>
<p><tt class="docutils literal"><span class="pre">__builtin_expect()</span></tt> can also be used with switch-statements:</p>
<div class="highlight-python"><div class="highlight"><pre>switch (__builtin_expect(switch_value, most_common_value)) {
  case 1: {
  }
  case 2: {
  }
  case most_common_value: {
  }
  case 3: {
  }
  ...
  default: {
  }
}
</pre></div>
</div>
<p>Although here it is probably better to fold out most_common_value with an <tt class="docutils literal"><span class="pre">if</span></tt>-statement and
put the <tt class="docutils literal"><span class="pre">switch</span></tt> in the <tt class="docutils literal"><span class="pre">else</span></tt> clause.</p>
 </p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1aa0672ea7123854cc5f51902a06c473fb"></span><strong>likely</strong>(expr)</p>
<blockquote>
<div><p></p>
<p></p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1af912ce3467a4aa2c5937426cda6240a2"></span><strong>OL_UNUSED</strong>(x)</p>
<blockquote>
<div><p></p>
<p><p><p>Macro to allow <tt class="docutils literal"><span class="pre">restrict</span></tt> as a keyword for <tt class="docutils literal"><span class="pre">C++</span></tt> compilation.
<tt class="docutils literal"><span class="pre">restrict</span></tt> was a keyword added to the <tt class="docutils literal"><span class="pre">C</span></tt> programming language as part of the <tt class="docutils literal"><span class="pre">C99</span></tt> standard; it boosts <tt class="docutils literal"><span class="pre">C</span></tt> performance to the
level of Fortran as the issue <tt class="docutils literal"><span class="pre">restrict</span></tt> addresses (pointer aliasing) was one of the biggest differences between the two.</p>
<p><tt class="docutils literal"><span class="pre">restrict</span></tt> is <em>NOT</em> a part of any <tt class="docutils literal"><span class="pre">C++</span></tt> standard (not even <tt class="docutils literal"><span class="pre">C++11</span></tt>).  However, due to its extreme
usefulness, most C++ compilers (e.g., gcc, icc) support it.</p>
<p>See references below for full details.  In short, the <tt class="docutils literal"><span class="pre">restrict</span></tt> keyword promises that <tt class="docutils literal"><span class="pre">restrict</span></tt>&#8216;d pointers will not
<em>WRITE ALIAS</em> or <em>READ/WRITE ALIAS</em> each other.  This extends to quantities deived from a <tt class="docutils literal"><span class="pre">restrict</span></tt>&#8216;d pointer, e.g.,</p>
<div class="highlight-python"><div class="highlight"><pre>double * restrict x;
</pre></div>
</div>
<p>Then no other pointer may alias <tt class="docutils literal"><span class="pre">x,</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">1,</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">2</span></tt>, etc.</p>
<p>Declare like:</p>
<div class="highlight-python"><div class="highlight"><pre>some_type * restrict pointer_to_some_type;
</pre></div>
</div>
<p>Note that since C/C++ declarations are read read right-to-left (e.g., pointer_to_some_type is a <tt class="docutils literal"><span class="pre">restrict</span></tt>&#8216;d pointer to
some_type), the following makes no sense:</p>
<div class="highlight-python"><div class="highlight"><pre>some_type restrict * illogical_pointer;
</pre></div>
</div>
<p>For multi-dimensional pointers, typically only:</p>
<div class="highlight-python"><div class="highlight"><pre>double ** restrict matrix;
</pre></div>
</div>
<p>is needed, but sometimes:</p>
<div class="highlight-python"><div class="highlight"><pre>double * restrict * restrict matrix;
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">double</span> <span class="o">*</span> <span class="n">restrict</span> <span class="o">*</span> <span class="n">matrix</span><span class="p">;</span>
</pre></div>
</div>
<p>are appropriate.</p>
<p>Suppose I have:</p>
<div class="highlight-python"><div class="highlight"><pre>double * restrict a = ...;
double * restrict b = ...;
</pre></div>
</div>
<p>Here, I promise that values WRITTEN through a will NEVER affect values read through b and vice versa.  In particular,
pointers that are only used for reading may be marked <tt class="docutils literal"><span class="pre">restrict</span></tt> and still alias each other with no bad effects.  If you
need <tt class="docutils literal"><span class="pre">restrict</span></tt>&#8216;d pointers for only a sub-part of a function, drop a scope { }.</p>
<p>For example, consider <tt class="docutils literal"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">A*x</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>double matrix_vector_multiply(double * A, double *x, int size, double * y) {
  for (int i=0; i&lt;size; ++i) {
    y[i] = 0.0;
    for (int j=0; j&lt;size; ++j) {
      y[i] += A[i*size +j] * x[j];
    }
  }
}
</pre></div>
</div>
<p>The compiler has to emit code that would be correct for:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">matrix_vector_multiply</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">A</span><span class="p">);</span>
</pre></div>
</div>
<p>So A is being read/written simultaneously.  In practical use, this makes no sense whatsoever.  But the compiler has to guarantee
that this case would be executed correctly, which severely limits optimizations since the aliasing possibility forces full
serialization of the entire loop.</p>
<p>Instead:</p>
<div class="highlight-python"><div class="highlight"><pre>double matrix_vector_multiply(double const * restrict A, double const * restict x, int size, double * restrict y);
</pre></div>
</div>
<p>tells the compiler that <tt class="docutils literal"><span class="pre">A,</span> <span class="pre">x</span></tt>, wil never read from values written through <tt class="docutils literal"><span class="pre">y</span></tt>.  (The same is true for <tt class="docutils literal"><span class="pre">y</span></tt> never reading from values
written from <tt class="docutils literal"><span class="pre">A,</span> <span class="pre">x</span></tt>; but this is trivial since <tt class="docutils literal"><span class="pre">A,</span> <span class="pre">x</span></tt> are now marked as pointers to const double.)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the compiler DOES NOT GUARANTEE that <tt class="docutils literal"><span class="pre">restrict</span></tt> is used correctly.  Invalid use of <tt class="docutils literal"><span class="pre">restrict</span></tt> will lead to undefined behavior.</p>
</div>
<p>You should essentially be able to mark EVERY pointer as <tt class="docutils literal"><span class="pre">restrict</span></tt>.  The aliased behavior allowed by not using <tt class="docutils literal"><span class="pre">restrict</span></tt> is
exceedingly confusing and SLOW, and it should be avoided.
Mark const whenever appropriate.</p>
<p>References:
<a class="reference external" href="http://en.wikipedia.org/wiki/Restrict">http://en.wikipedia.org/wiki/Restrict</a>
<a class="reference external" href="http://publib.boulder.ibm.com/infocenter/comphelp/v7v91/index.jsp?topic=%2Fcom.ibm.vacpp7a.doc%2Flanguage%2Fref%2Fclrc03restrict_type_qualifier.htm">http://publib.boulder.ibm.com/infocenter/comphelp/v7v91/index.jsp?topic=%2Fcom.ibm.vacpp7a.doc%2Flanguage%2Fref%2Fclrc03restrict_type_qualifier.htm</a>
<a class="reference external" href="http://cellperformance.beyond3d.com/articles/2006/05/demystifying-the-restrict-keyword.html">http://cellperformance.beyond3d.com/articles/2006/05/demystifying-the-restrict-keyword.html</a></p>
</p>
<p><p>gcc macro to label functions &amp; function parameters as unused.  This suppresses a large number of warnings.
We may have unused parameters in templated functions&#8211;say a template written to handle matrices but also used
for vectors (treated as a <tt class="docutils literal"><span class="pre">1</span> <span class="pre">x</span> <span class="pre">n</span></tt> matrix; then the leading dimension is unused)</p>
<p>Recall that <tt class="docutils literal"><span class="pre">##</span></tt> concatenates, so that the name <tt class="docutils literal"><span class="pre">foo</span></tt> in <tt class="docutils literal"><span class="pre">OL_UNUSED(foo)</span></tt> is expanded to <tt class="docutils literal"><span class="pre">UNUSED_foo</span></tt></p>
 </p>
</p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1a43aad231fa6009d48201a76fd7dfb6dc"></span><strong>OL_NONNULL_POINTERS</strong></p>
<blockquote>
<div><p></p>
<p><p>gcc macro to specify (= promise the compiler) that no <tt class="docutils literal"><span class="pre">nullptr</span></tt> pointers will be passed as function args.
Warnings will be issued if the compiler can determine the rule is being violated.  Runtime checks are NOT
performed, so &#8220;cheating&#8221; and passing null pointers results in undefined behavior.</p>
<p>Note about the use of <tt class="docutils literal"><span class="pre">OL_NONNULL_POINTERS_LIST</span></tt>: Indexing starts from 1 at left-most function arg for <tt class="docutils literal"><span class="pre">C</span></tt> functions
and non-class member <tt class="docutils literal"><span class="pre">C++</span></tt> functions; from 2 otherwise.  In <tt class="docutils literal"><span class="pre">C++</span></tt> member functions, the first argument is implicitly
the <tt class="docutils literal"><span class="pre">this</span></tt> pointer, hence why indexing starts at 2.
DO NOT specify <tt class="docutils literal"><span class="pre">this</span></tt> in the list in <tt class="docutils literal"><span class="pre">C++</span></tt> member functions!  It is undefined behavior for <tt class="docutils literal"><span class="pre">this</span></tt> to be <tt class="docutils literal"><span class="pre">nullptr</span></tt> so
this attribute makes no sense for <tt class="docutils literal"><span class="pre">this</span></tt>.</p>
 </p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1a8fc43c45214906a63fd130b73a620b0b"></span><strong>OL_NONNULL_POINTERS_LIST</strong>(...)</p>
<blockquote>
<div><p></p>
<p></p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1abda439d29ae03a473c1167e47159ae90"></span><strong>OL_WARN_UNUSED_RESULT</strong></p>
<blockquote>
<div><p></p>
<p><p>gcc macro to enable warning if the return value of a function is not used.</p>
 </p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1a70502a04ab9d3f6f826eb4153d59ccc6"></span><strong>OL_CONST_FUNCTION</strong></p>
<blockquote>
<div><p></p>
<p><p>gcc macro to label functions as &#8220;const&#8221;.  Such a function has NO SIDE EFFFECTS and no effects beyond the return value.
Additionally, a pure function&#8217;s return depends only on input parameters&#8211;NO global memory.  In particular, a const
function cannot dereference pointers.</p>
 </p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1ab292cebcecf848d47dd4d631e3028390"></span><strong>OL_PURE_FUNCTION</strong></p>
<blockquote>
<div><p></p>
<p><p>gcc macro to label functions as &#8220;pure&#8221;.  Pure functions are like const functions except they are additionally
allowed to READ global memory (but not write&#8211;no side effects!).  See gcc docs for more information.</p>
 </p>
</div></blockquote>
<p><span class="target" id="project0gpp__common_8hpp_1afaa7e8558d5f0b48a94ec59de078f885"></span><strong>OL_NORETURN</strong></p>
<blockquote>
<div><p></p>
<p><p>Some functions never return, e.g., <tt class="docutils literal"><span class="pre">abort()</span></tt>, <tt class="docutils literal"><span class="pre">terminate()</span></tt>, or functions that
always invoke throw.  noreturn allows gcc to generate cleaner code; it also
makes the required behavior clear.</p>
 </p>
</div></blockquote>
</div></blockquote>
<p><p id="project0namespaceoptimal__learning"><em>namespace</em> <strong>optimal_learning</strong></p>
<blockquote>
<div><p></p>
<p></p>
<em>Functions</em><blockquote>
<div><p><span class="target" id="project0namespaceoptimal__learning_1a947015d6105c99474f4dc75d03dbe8b0"></span><div class="line-block">
<div class="line">template &lt; typename T &gt;</div>
<div class="line">constexpr  <a class="reference internal" href="#project0gpp__common_8hpp_1abda439d29ae03a473c1167e47159ae90"><em>OL_WARN_UNUSED_RESULT</em></a>   <a class="reference internal" href="#project0gpp__common_8hpp_1a70502a04ab9d3f6f826eb4153d59ccc6"><em>OL_CONST_FUNCTION</em></a>  T <strong>Square</strong>(T value)</div>
</div>
</p>
<blockquote>
<div><p></p>
<p><p>icc <tt class="docutils literal"><span class="pre">C++11</span></tt> support before v14.x.x is incomplete and does not support the <tt class="docutils literal"><span class="pre">override`</span>
<span class="pre">or</span> <span class="pre">``final</span></tt> specifiers (although &#8220;final&#8221; appears to work). See:
<a class="reference external" href="https://software.intel.com/en-us/articles/c0x-features-supported-by-intel-c-compiler">https://software.intel.com/en-us/articles/c0x-features-supported-by-intel-c-compiler</a></p>
<p><p>Square a <tt class="docutils literal"><span class="pre">constexpr</span></tt> value.
For details on what <tt class="docutils literal"><span class="pre">constexpr</span></tt> expects:
<a class="reference external" href="http://www.stroustrup.com/C++11FAQ.html#constexpr">http://www.stroustrup.com/C++11FAQ.html#constexpr</a>
<a class="reference external" href="http://en.cppreference.com/w/cpp/language/constexpr">http://en.cppreference.com/w/cpp/language/constexpr</a></p>
<p>Basically, the compiler <em>can</em> evaluate this function at compile time, so its structure/inputs are restricted
to things that could potentially be compile-time constants.</p>
<p>This means SQ will fail with non-constexpr inputs.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">this is pass-by-VALUE.  In combination with constexpr, this fcn is only meant for very simple operations.</p>
</div>
<p>(i.e., this shouldn&#8217;t be used with a matrix class supporting operator*, and it probably wouldn&#8217;t compile anyway.)
If you need pass-by-reference, be warned that it <tt class="docutils literal"><span class="pre">Square(const</span> <span class="pre">T&amp;)</span></tt> may fail in icc:
<a class="reference external" href="http://software.intel.com/en-us/articles/c0x-features-supported-by-intel-c-compiler">http://software.intel.com/en-us/articles/c0x-features-supported-by-intel-c-compiler</a>
<a class="reference external" href="http://software.intel.com/en-us/forums/topic/391885">http://software.intel.com/en-us/forums/topic/391885</a>
They claim it&#8217;ll be available in the 14.0 compiler.</p>
<dl class="docutils">
<dt><strong>Parameters</strong>:</dt>
<dd><table class="first last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">value:</th><td class="field-body">value to be squared</td>
</tr>
</tbody>
</table>
</dd>
<dt><strong>Returns</strong>:</dt>
<dd>the product: value * value</dd>
</dl>
 </p>
</p>
</div></blockquote>
</div></blockquote>
<em>Variables</em><blockquote>
<div><p><span class="target" id="project0namespaceoptimal__learning_1ab0e0140c7105db3f483cac213245cd29"></span>constexpr double <strong>kPi</strong></p>
<blockquote>
<div><p></p>
<p><p>Macros for a few useful mathematical constants.</p>
 </p>
</div></blockquote>
<p><span class="target" id="project0namespaceoptimal__learning_1a3a5d239e35886cee60fa2a9195d73b0e"></span>constexpr double <strong>kSqrt3</strong></p>
<blockquote>
<div><p></p>
<p></p>
</div></blockquote>
<p><span class="target" id="project0namespaceoptimal__learning_1ab7408385ffa1bdc85b78a1c2c0ee68de"></span>constexpr double <strong>kSqrt5</strong></p>
<blockquote>
<div><p></p>
<p></p>
</div></blockquote>
<p><span class="target" id="project0namespaceoptimal__learning_1ad4315dd4419b0955fe37362ff4b18a3a"></span>constexpr double <strong>kLog2Pi</strong></p>
<blockquote>
<div><p></p>
<p></p>
</div></blockquote>
</div></blockquote>
<p><p id="project0structoptimal__learning_1_1_identify_type"><em>class</em> <strong>IdentifyType</strong></p>
<blockquote>
<div><p></p>
<p><p>Work-around for compilers (icc &lt;= v13.0, gcc &lt;= v4.5, msvcc &lt;= 2013) that cannot deal with:</p>
<div class="highlight-python"><div class="highlight"><pre>struct Foo {
  SomeType i;
};
Foo f;
SomeType y = decltype(f)::i;
</pre></div>
</div>
<p>That is, resolve the scoping operator with <tt class="docutils literal"><span class="pre">decltype()</span></tt>.  Instead, do:</p>
<div class="highlight-python"><div class="highlight"><pre>SomeType y = IdentifyType&lt;decltype(f)&gt;::type::i;
</pre></div>
</div>
<p>This can be removed once the relevant compilers support <tt class="docutils literal"><span class="pre">decltype</span></tt> + scoping.</p>
 </p>
<em>Public Type</em><blockquote>
<div><p><span class="target" id="project0structoptimal__learning_1_1_identify_type_1ab4496f710493b8f07998b371ceff7d77"></span>typedef T <strong>type</strong></p>
<blockquote>
<div><p></p>
<p></p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</p>
</div></blockquote>
</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="gpp_python_gaussian_process.html" class="btn btn-neutral" title="gpp_python_gaussian_process"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Yelp and Cornell Collaboration.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>