

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Objective Functions &mdash; MOE 0.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/breathe.css" type="text/css" />
  
    <link rel="top" title="MOE 0.1.0 documentation" href="index.html"/>
        <link rel="next" title="Examples" href="examples.html"/>
        <link rel="prev" title="Pretty Endpoints" href="pretty_endpoints.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> MOE</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="why_moe.html">Why Do We Need MOE?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="why_moe.html#other-methods">Other Methods</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#install-in-docker">Install in docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#install-from-source">Install from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#osx-tips">OSX Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#building-boost">Building Boost</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#linux-tips">Linux Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#cmake-tips">CMake Tips</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="moe_math.html">How does MOE work?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="moe_math.html#build-a-gaussian-process-gp-with-the-historical-data">Build a Gaussian Process (GP) with the historical data</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_math.html#optimize-the-hyperparameters-of-the-gaussian-process">Optimize the hyperparameters of the Gaussian Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_math.html#find-the-point-s-of-highest-expected-improvement-ei">Find the point(s) of highest Expected Improvement (EI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_math.html#return-the-point-s-to-sample-then-repeat">Return the point(s) to sample, then repeat</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="demo_tutorial.html">Demo Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="demo_tutorial.html#the-interactive-demo">The Interactive Demo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pretty_endpoints.html">Pretty Endpoints</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Objective Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-an-objective-function">What is an objective function?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#properties-of-an-objective-function">Properties of an objective function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1"><span class="math">\(\Phi\)</span> Objective Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-of-objective-functions">Example of Objective Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples.html#minimizing-an-arbitrary-function">Minimizing an arbitrary function</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#gaussian-process-regression-given-historical-data">Gaussian Process regression given historical data</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#hyperparameter-optimization-of-a-gaussian-process">Hyperparameter optimization of a Gaussian Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#all-above-examples-combined">All above examples combined</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#setting-thresholds-for-advertising-units">Setting thresholds for advertising units</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#making-a-pull-request">Making a pull request</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#style">Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#versioning">Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#releasing-for-maintainers">Releasing (For Maintainers)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#what-license-is-moe-released-under">What license is MOE released under?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#when-should-i-use-moe">When should I use MOE?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#what-is-the-time-complexity-of-moe">What is the time complexity of MOE?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-cite-moe">How do I cite MOE?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#why-does-moe-take-so-long-to-return-the-next-points-to-sample-for-some-inputs">Why does MOE take so long to return the next points to sample for some inputs?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-bootstrap-moe-what-initial-data-does-it-need">How do I bootstrap MOE? What initial data does it need?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-many-function-evaluations-do-i-need-before-moe-is-done">How many function evaluations do I need before MOE is &#8220;done&#8221;?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-many-function-evaluations-do-i-perform-before-i-update-the-hyperparameters-of-the-gp">How many function evaluations do I perform before I update the hyperparameters of the GP?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#will-you-accept-my-pull-request">Will you accept my pull request?</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="moe.html">moe package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="moe.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe.html#module-moe.resources">moe.resources module</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe.html#module-moe">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="moe_examples.html">moe_examples package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#module-moe_examples.combined_example">moe_examples.combined_example module</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#module-moe_examples.hyper_opt_of_gp_from_historical_data">moe_examples.hyper_opt_of_gp_from_historical_data module</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#module-moe_examples.mean_and_var_of_gp_from_historic_data">moe_examples.mean_and_var_of_gp_from_historic_data module</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#module-moe_examples.next_point_via_simple_endpoint">moe_examples.next_point_via_simple_endpoint module</a></li>
<li class="toctree-l2"><a class="reference internal" href="moe_examples.html#module-moe_examples">Module contents</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cpp_tree.html">C++ Files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gpp_optimization_test.html">gpp_optimization_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_domain_test.html">gpp_domain_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_exception.html">gpp_exception</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_geometry.html">gpp_geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_heuristic_expected_improvement_optimization.html">gpp_heuristic_expected_improvement_optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_linear_algebra-inl.html">gpp_linear_algebra-inl</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_test_utils.html">gpp_test_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_logging.html">gpp_logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_covariance.html">gpp_covariance</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_python_test.html">gpp_python_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_domain.html">gpp_domain</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_python_common.html">gpp_python_common</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_hyperparameter_optimization_demo.html">gpp_hyperparameter_optimization_demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_test_utils_test.html">gpp_test_utils_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_math_test.html">gpp_math_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_python_expected_improvement.html">gpp_python_expected_improvement</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_python_model_selection.html">gpp_python_model_selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_math.html">gpp_math</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_random_test.html">gpp_random_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_optimizer_parameters.html">gpp_optimizer_parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_expected_improvement_demo.html">gpp_expected_improvement_demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_random.html">gpp_random</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_geometry_test.html">gpp_geometry_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_linear_algebra.html">gpp_linear_algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_heuristic_expected_improvement_optimization_test.html">gpp_heuristic_expected_improvement_optimization_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_linear_algebra_test.html">gpp_linear_algebra_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_model_selection.html">gpp_model_selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_optimization.html">gpp_optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_covariance_test.html">gpp_covariance_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_mock_optimization_objective_functions.html">gpp_mock_optimization_objective_functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_python.html">gpp_python</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_model_selection_test.html">gpp_model_selection_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_hyper_and_EI_demo.html">gpp_hyper_and_EI_demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_python_gaussian_process.html">gpp_python_gaussian_process</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpp_common.html">gpp_common</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">MOE</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Objective Functions</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/objective_functions.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="objective-functions">
<h1>Objective Functions<a class="headerlink" href="#objective-functions" title="Permalink to this headline">¶</a></h1>
<p><strong>Contents:</strong></p>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference internal" href="#what-is-an-objective-function">What is an objective function?</a></li>
<li><a class="reference internal" href="#properties-of-an-objective-function">Properties of an objective function</a></li>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#phi-objective-functions">Phi Objective Functions</a></li>
</ol>
</div></blockquote>
<div class="section" id="what-is-an-objective-function">
<h2>What is an objective function?<a class="headerlink" href="#what-is-an-objective-function" title="Permalink to this headline">¶</a></h2>
<p>The objective function is the function <em>f</em> that we are trying to minimize/maximize over some set of <a class="reference internal" href="#parameters">Parameters</a>.</p>
<div class="math">
\[\begin{split}\begin{eqnarray*}
    \underset{\vec{x} \in \mathbb{R}^{d}}{\mathrm{argmax}} \ f (\vec{x}) \\
    f : \mathbb{R}^{d} \rightarrow \mathbb{R}
\end{eqnarray*}\end{split}\]</div>
<p>The objective function is considered a <strong>black box</strong> (<a class="reference external" href="http://en.wikipedia.org/wiki/Black_box">http://en.wikipedia.org/wiki/Black_box</a>) function. We require no internal knowledge or access to the function. In fact it can potentially be non-convex, non-differentiable or non-continuous. Furthermore, we assume that evaluating the function, <em>f</em>, is <strong>expensive</strong> and we need to find the best set of parameters/inputs <span class="math">\(\vec{x}\)</span> with as few function evaluations as possible.</p>
<p>The input to MOE is some set of historical parameters sampled <span class="math">\(\{\vec{x}_{1}, \ldots, \vec{x}_{n}\}\)</span> and their associated function valuations <span class="math">\(\{f(\vec{x}_{1}), \ldots, f(\vec{x}_{n})\}\)</span>. The evaluations may require A/B testing, an map reduce job or some other expensive or time consuming process. MOE will never need to evaluate <em>f</em>, it only takes the outputs you provide and suggests new optimal inputs to test/evaluate.</p>
<p>Using this information MOE builds a model the function space <em>f</em> is drawn from (using a Gaussian Process (GP) <a class="reference internal" href="gpp_covariance.html"><em>gpp_covariance</em></a>) over values of <span class="math">\(\vec{x} \in \mathbb{R}^{d}\)</span> and maximizes the Expected Improvement (EI, <a class="reference internal" href="gpp_expected_improvement_demo.html"><em>gpp_expected_improvement_demo</em></a>) of sampling different potential values <span class="math">\(\vec{x}\)</span> in this space, without actually evaluating <em>f</em>. MOE then outputs the <em>q</em> value(s) in <span class="math">\(\mathbb{R}^{d \times q}\)</span> that have the highest EI to be sampled next by the user.</p>
</div>
<div class="section" id="properties-of-an-objective-function">
<h2>Properties of an objective function<a class="headerlink" href="#properties-of-an-objective-function" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>An objective function is any real valued function <em>f</em> defined over the input parameters.</li>
<li>MOE works best if the objective function has 0 mean, although this in not required depending on the covariance kernel (<a class="reference internal" href="gpp_covariance.html"><em>gpp_covariance</em></a>)</li>
<li>MOE minimizes an objective function by default. To maximize just multiply all function evaluations by -1.</li>
<li>Objective functions can be composed of many different metrics see <a class="reference internal" href="#the-metrics">The Metrics</a></li>
<li>See below for examples of different objective functions and a class of objective functions that work well with MOE</li>
</ul>
<p>See <a class="reference internal" href="examples.html"><em>Examples</em></a></p>
</div>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<p>Parameters are any real valued constants, config values, thresholds, hyperparameters or <em>magic numbers</em> in your codebase or inputs to your system/model/experiment.</p>
<p><strong>Examples:</strong></p>
<ul class="simple">
<li>Weights of arbitrary scoring functions</li>
<li>Thresholds for when advertisments have certain attributes</li>
<li>Hyperparameters for features of scoring functions</li>
<li>Hyperparameters of ML algorithms</li>
<li>Thresholds for when/how to show ads or other content</li>
<li>Constants large/expensive training algorithms</li>
</ul>
<p>See <a class="reference internal" href="examples.html"><em>Examples</em></a></p>
</div>
<div class="section" id="id1">
<h2><span class="math">\(\Phi\)</span> Objective Functions<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>In this writeup we define a class of objective functions, <span class="math">\(\Phi\)</span> objective functions, that MOE can use, their components and some examples.</p>
<div class="section" id="properties-of-the-proposed-objective-function">
<h3>Properties of the proposed objective function <span class="math">\(\Phi\)</span><a class="headerlink" href="#properties-of-the-proposed-objective-function" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>The objective function, <span class="math">\(\Phi\)</span>, is the quantity that MOE seeks to maximize by manipulating the values of parameters in some space.</li>
<li>The objective function <span class="math">\(\Phi\)</span> is well defined for every set of parameters <span class="math">\(C_{i} \in \vec{C}\)</span> for which the experiment is run.</li>
<li>The objective function is defined relative to the status quo set of parameters; <span class="math">\(C_{S} \in \vec{C}\)</span>. By construction the objective function has value 0 for the status quo. Parameters that outperform the status quo will have positive values, those that perform worse will have negative values.</li>
<li>The objective function is designed by construction to be scaleless, unitless and have meaningful and intuitive representation in linear and log space. For examples see below.</li>
<li>The objective function is defined over parameters <span class="math">\(\vec{C}\)</span> and objective function parameters <span class="math">\(\mathbb{P}\)</span> which encompasses all relevant metrics, weights and thresholds.</li>
<li><span class="math">\(\Phi : C_{i} \in \vec{C}, \mathbb{P} \rightarrow [-1, \infty)\)</span>. Lower values imply the parameters are worse than the status quo, higher values imply they are better. A value of 0 implies they are indistinguishable from the status quo.</li>
</ol>
<p>It is worth noting that MOE will attempt to increase the objective function blindly. MOE is a <strong>black box</strong>, global optimization experimental design framework. If there are easy ways for it to exploit the code by manipulating parameters it will probably find it. Defining the objective function well is the most important part of running a MOE experiment.</p>
</div>
<div class="section" id="classes-of-objective-functions">
<h3>Classes of <span class="math">\(\Phi\)</span> objective functions<a class="headerlink" href="#classes-of-objective-functions" title="Permalink to this headline">¶</a></h3>
<p>The general class of objective functions <span class="math">\(\Phi\)</span> are products of weighted, thresholded relative compositions of metrics <span class="math">\(M\)</span> defined for each set of parameters <span class="math">\(C_{i}\)</span> of an experiment as follows:</p>
<div class="math">
\[\begin{equation}
    \Phi\left(C_{i}, \mathbb{P} = \left(\vec{M}, \vec{\omega_{M}}, \vec{\tau_{M}}\right)\right) = \prod_{\{M, \omega, \tau \} \in \mathbb{P}} \left( \left(\frac{M(C_{i})}{M(C_{S})}\right)^{\omega_{M}} \mathcal{H} \left(\text{sgn}\left(\omega_{M}\right)\left(\frac{M(C_{i})}{M(C_{S})} - \tau_{M}\right)\right) \right) - 1.
\end{equation}\]</div>
<p>where <cite>M(C_{i})</cite> is the value of the metric for a set of parameters <span class="math">\(C_{i}\)</span>, <cite>M(C_{S})</cite> is the value of the metric for the status quo parameters <span class="math">\(C_{S} \in \vec{C}\)</span> and <span class="math">\(\mathcal{H}(x)\)</span> is the Heaviside function defined as</p>
<div class="math">
\[\begin{equation}
    \mathcal{H}(x) = \left\{ 1 \text{ if } x \geq 0; \ 0 \text{ otherwise.} \right.
\end{equation}\]</div>
<p>The parameters <span class="math">\(\omega_{M}, \tau_{M}\)</span> represent the weight and threshold of the metric respectively. Note that we subtract 1 from the end of the objective function so that the status quo parameters <span class="math">\(C_{S}\)</span> will result in a value of 0,</p>
<div class="math">
\[\begin{equation}
    \Phi\left(C_{S}, \mathbb{P}\right) = 0.
\end{equation}\]</div>
<p>One can break the objective function for each metric into two distinct parts. First, the relative gain over the status quo,</p>
<div class="math">
\[\begin{equation}
    \left(\frac{M(C_{i})}{M(C_{S})}\right)^{\omega_{M}}
\end{equation}\]</div>
<p>The fraction will be larger than 1 if the parameters have a larger metric <span class="math">\(M\)</span> than the status quo, otherwise it will be less than one. Note that for the status quo itself this fraction will be exactly 1. The magnitude and sign of the weight determine how important this metric <span class="math">\(M\)</span> is in the overall objective function. The weight will be discussed in a later section.</p>
<p>The second component of the objective function is the threshold,</p>
<div class="math">
\[\begin{equation}
    \mathcal{H} \left(\text{sgn}\left(\omega_{M}\right)\left(\frac{M(C_{i})}{M(C_{S})} - \tau_{M}\right)\right)
\end{equation}\]</div>
<p>If the relative gain (or loss if <span class="math">\(\omega_{M} &lt; 0\)</span>) of the metric <span class="math">\(M\)</span> for the set of parameters <span class="math">\(C_{i}\)</span> is below the threshold <span class="math">\(\tau_{M}\)</span> this component will have value 0. Note that this will cancel all gains in all other metrics and give the objective function its lowest possible value. One can also replace the Heavyside function with a logistic function, or a probability of violating the constraints.</p>
</div>
<div class="section" id="the-metrics">
<h3>The Metrics<a class="headerlink" href="#the-metrics" title="Permalink to this headline">¶</a></h3>
<p>The metric is any quantity defined over sets of parameters.</p>
<p>Possible examples include:</p>
<ol class="arabic simple">
<li>Click Through Rate (CTR)</li>
<li>Sell Through Rate (STR, the number of ads shown per page)</li>
<li>Revenue Per Opportunity (RPO)</li>
<li>Average/median/95th delivery timings</li>
<li>Any happiness metric defined on the reals</li>
<li>Number of reviews written</li>
<li>Photo contributions/views in a session</li>
<li>User engagement</li>
<li>Conversions</li>
<li>Any metric about the user, session or page that can be defined on the reals</li>
<li><span class="math">\(M : C_{i} \rightarrow \Re \ \ \ \forall C_{i} \in \vec{C}\)</span></li>
</ol>
</div>
<div class="section" id="the-weight">
<h3>The Weight<a class="headerlink" href="#the-weight" title="Permalink to this headline">¶</a></h3>
<p>The weight <span class="math">\(\omega_{M}\)</span> of a function represents how much we want the ratio of that metric to effect the overall objective function.</p>
<div class="math">
\[\begin{equation}
    \omega_{M} \in [0, \infty)
\end{equation}\]</div>
<p>A weight <span class="math">\(\omega_{M} = 0\)</span> corresponds to no effect. The objective function will become just the Heaviside function.</p>
<p>Small weights <span class="math">\(0 &lt; \omega_{M} &lt; 1\)</span> will pull ratios lower and higher than 1 closer to 1. Large weights <span class="math">\(1 &lt; \omega_{M}\)</span> will have the opposite effect.</p>
</div>
<div class="section" id="the-threshold">
<h3>The Threshold<a class="headerlink" href="#the-threshold" title="Permalink to this headline">¶</a></h3>
<p>The threshold represents how far we are willing to allow the specific metric to drop before we consider there to be no utility. For example if we wish to keep Sell Through Rate (STR) at at least 85% of its current value we would set <span class="math">\(\tau_{M} = 0.85\)</span> for that metric. Parameters with a ratio of STR lower than this threshold will have an objective function equal to 0.</p>
<div class="math">
\[\begin{equation}
    \tau_{M} \in [0, 1]
\end{equation}\]</div>
</div>
<div class="section" id="log-space">
<h3>Log Space<a class="headerlink" href="#log-space" title="Permalink to this headline">¶</a></h3>
<p>We note that the objective functions decompose into log space readily, which is helpful because maximizing the original objective function is equivalent to maximizing it in log space (because it is a monotonic transform),</p>
<div class="math">
\[\begin{equation}
    \log \Phi(C_{i}, M, \omega_{M}, \tau_{M}) = \omega_{M} \log \left(\frac{M(C_{i})}{M(C_{S})}\right) + \log \mathcal{H} \left(\text{sgn}\left(\omega_{M}\right)\left(\frac{M(C_{i})}{M(C_{S})} - \tau_{M}\right)\right).
\end{equation}\]</div>
<p>The log of the Heaviside function now returns a value of 0 or <span class="math">\(-\infty\)</span> and can be calculated separately for numerical reasons.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The range now becomes,</p>
<div class="last math">
\[\begin{equation}
    \log \Phi : C_{i} \in \vec{C} \rightarrow (-\infty, \infty)
\end{equation}\]</div>
</div>
</div>
</div>
<div class="section" id="example-of-objective-functions">
<h2>Example of Objective Functions<a class="headerlink" href="#example-of-objective-functions" title="Permalink to this headline">¶</a></h2>
<p>Below are examples of different intuitive ideals and the resulting objective functions.</p>
<div class="section" id="click-through-rate-ctr-only">
<h3>Click Through Rate (CTR) Only<a class="headerlink" href="#click-through-rate-ctr-only" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s say we only care about CTR, and we want to make sure no parameters allow it to fall more than 95%. We define <span class="math">\(\mathbb{P}\)</span> as;</p>
<div class="math">
\[\begin{split}\begin{eqnarray*}
    \vec{M} &amp; = &amp; \left\{\text{CTR}\right\} \\
    \vec{\omega} &amp; = &amp; \left\{1.0\right\} \\
    \vec{\tau} &amp; = &amp; \left\{0.95\right\}
\end{eqnarray*}\end{split}\]</div>
<p>which results in</p>
<div class="math">
\[\begin{equation}
    \Phi(C_{i}, \mathbb{P}) = \left(\frac{CTR(C_{i})}{CTR(C_{S})}\right)\mathcal{H}\left(\frac{CTR(C_{i})}{CTR(C_{S})} - 0.95\right) - 1
\end{equation}\]</div>
</div>
<div class="section" id="clicks-per-opportunity-cpo">
<h3>Clicks Per Opportunity (CPO)<a class="headerlink" href="#clicks-per-opportunity-cpo" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s say we only care about Clicks Per Opportunity (CPO) which is the product of CTR and STR. We define <span class="math">\(\mathbb{P}\)</span> as;</p>
<div class="math">
\[\begin{split}\begin{eqnarray*}
    \vec{M} &amp; = &amp; \left\{\text{CTR}, \text{STR}\right\} \\
    \vec{\omega} &amp; = &amp; \left\{1, 1\right\} \\
    \vec{\tau} &amp; = &amp; \left\{0, 0\right\}
\end{eqnarray*}\end{split}\]</div>
<p>which results in</p>
<div class="math">
\[\begin{equation}
    \Phi(C_{i}, \mathbb{P}) = \left(\frac{CTR(C_{i})}{CTR(C_{S})}\right)\left(\frac{STR(C_{i})}{STR(C_{S})}\right) - 1
\end{equation}\]</div>
<p>Note that <span class="math">\(\tau = 0\)</span> for a metric effectively removes the Heavyside function from the objective function for that metric.</p>
</div>
<div class="section" id="mixture-example">
<h3>Mixture Example<a class="headerlink" href="#mixture-example" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s say we mostly care about CTR, but wouldn&#8217;t mind if STR also went up. We don&#8217;t want to make the site any more than 10% slower though so we introduce a metric MDT, which will be the Mean Delivery Time (MDT) in milliseconds for the given set of parameters. We define <span class="math">\(\mathbb{P}\)</span> as;</p>
<div class="math">
\[\begin{split}\begin{eqnarray*}
    \vec{M} &amp; = &amp; \left\{\text{CTR}, \text{STR}, \text{MDT}\right\} \\
    \vec{\omega} &amp; = &amp; \left\{1, \frac{1}{5}, 0\right\} \\
    \vec{\tau} &amp; = &amp; \left\{0, 0, \frac{9}{10}\right\}
\end{eqnarray*}\end{split}\]</div>
<p>which results in</p>
<div class="math">
\[\begin{equation}
    \Phi(C_{i}, \mathbb{P}) = \left(\frac{CTR(C_{i})}{CTR(C_{S})}\right)\left(\frac{STR(C_{i})}{STR(C_{S})}\right)^{\frac{1}{5}}\mathcal{H}\left(\frac{MDT(C_{i})}{MDT(C_{S})} - \frac{9}{10}\right) - 1
\end{equation}\]</div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pretty_endpoints.html" class="btn btn-neutral" title="Pretty Endpoints"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2014 Yelp. MOE is licensed under the Apache License, Version 2.0: http://www.apache.org/licenses/LICENSE-2.0.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>